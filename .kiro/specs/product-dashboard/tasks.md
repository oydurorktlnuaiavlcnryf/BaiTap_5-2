# Implementation Plan: Product Dashboard

## Overview

Triển khai Product Dashboard sử dụng HTML5, Bootstrap 5.3, và Vanilla JavaScript. Ứng dụng sẽ tương tác với Platzi Fake Store API để thực hiện CRUD operations, search, pagination, sorting và CSV export.

## Tasks

- [x] 1. Setup project structure and HTML base
  - [x] 1.1 Create index.html with meta tags and CDN links
    - Add Bootstrap 5.3 CSS CDN
    - Add Font Awesome 6 CDN
    - Add viewport meta tag for responsive
    - _Requirements: 11.1, 11.4_
  - [x] 1.2 Add custom CSS styles in style tag
    - Gradient header background (#667eea to #764ba2)
    - Table hover effects and transitions
    - Tooltip styling (position absolute, z-index)
    - Loading spinner overlay
    - Product image styling (50x50px, rounded)
    - _Requirements: 11.2, 11.3, 11.5_
  - [x] 1.3 Create header section HTML
    - Dashboard title with gradient background
    - Subtitle with API reference
    - _Requirements: 11.2_
  - [x] 1.4 Create controls section HTML
    - Search input with icon
    - Items per page dropdown (5, 10, 20)
    - Create new product button
    - Export CSV button
    - _Requirements: 2.1, 3.1, 8.1, 9.1_
  - [x] 1.5 Create table structure HTML
    - Table with Bootstrap classes (table, table-hover)
    - Table headers: ID, Title (sortable), Price (sortable), Category, Images
    - Sort icons in headers
    - Table body container for dynamic rows
    - _Requirements: 1.3, 4.1, 4.2, 4.4_

  - [x] 1.6 Create pagination section HTML
    - Pagination container with Bootstrap classes
    - Previous/Next buttons
    - Page numbers container
    - Page info display area
    - _Requirements: 3.2, 3.3, 3.6_
  - [x] 1.7 Create modal structures HTML
    - Detail Modal: product info display, image gallery, Edit button
    - Edit Modal: form with Title, Price, Description, Category ID, Images fields
    - Create Modal: same form structure as Edit Modal
    - _Requirements: 6.2, 6.3, 7.2, 8.2_
  - [x] 1.8 Create tooltip and loading elements HTML
    - Hidden tooltip div for description display
    - Loading spinner overlay
    - _Requirements: 5.1, 1.2_
  - [x] 1.9 Create app.js with global state variables
    - API_BASE_URL constant
    - allProducts, filteredProducts arrays
    - currentPage, itemsPerPage variables
    - currentSortField, currentSortOrder variables
    - currentProductId variable
    - _Requirements: 1.1_

- [x] 2. Implement API service and data loading
  - [x] 2.1 Implement showLoading() function
    - Show/hide loading spinner overlay
    - _Requirements: 1.2_
  - [x] 2.2 Implement showError() function
    - Display user-friendly error message
    - Use Bootstrap alert component
    - _Requirements: 1.4_
  - [x] 2.3 Implement fetchProducts() function
    - Use async/await with fetch API
    - GET request to API_BASE_URL/products
    - Store response in allProducts array
    - Copy to filteredProducts array
    - Handle errors with try-catch
    - Show/hide loading state
    - _Requirements: 1.1, 1.2, 1.4_
  - [x] 2.4 Implement renderTable() function
    - Calculate start/end index based on currentPage and itemsPerPage
    - Slice filteredProducts for current page
    - Generate table row HTML for each product
    - Display ID, title, price, category name, first image
    - Add data-id attribute to rows for click handling
    - Add image onerror handler for placeholder
    - _Requirements: 1.3, 1.5, 1.6_
  - [x] 2.5 Initialize app on DOMContentLoaded
    - Call fetchProducts()
    - Call renderTable()
    - Attach event listeners
    - _Requirements: 1.1_

- [x] 3. Implement pagination functionality
  - [x] 3.1 Implement calculatePagination() helper function
    - Calculate totalPages from filteredProducts.length and itemsPerPage
    - Calculate startIndex and endIndex for current page
    - Return pagination state object
    - _Requirements: 3.6_
  - [x] 3.2 Implement updatePagination() function
    - Generate Previous button (disabled on page 1)
    - Generate page number buttons with active state
    - Generate Next button (disabled on last page)
    - Attach click handlers to buttons
    - _Requirements: 3.2, 3.3, 3.4, 3.5_
  - [x] 3.3 Implement updatePageInfo() function
    - Calculate X = (currentPage - 1) * itemsPerPage + 1
    - Calculate Y = min(currentPage * itemsPerPage, totalItems)
    - Display "Showing X-Y of Z products"
    - _Requirements: 3.6_
  - [x] 3.4 Implement goToPage() function
    - Update currentPage variable
    - Call renderTable()
    - Call updatePagination()
    - Call updatePageInfo()
    - _Requirements: 3.2_
  - [x] 3.5 Implement changeItemsPerPage() function
    - Update itemsPerPage from dropdown value
    - Reset currentPage to 1
    - Call renderTable()
    - Call updatePagination()
    - Call updatePageInfo()
    - _Requirements: 3.1, 3.7_
  - [x] 3.6 Attach pagination event listeners
    - Items per page dropdown change event
    - Page button click events
    - _Requirements: 3.1_

- [x] 4. Implement search functionality
  - [x] 4.1 Implement handleSearch() function
    - Get search term from input
    - Filter allProducts by title (case-insensitive)
    - Update filteredProducts array
    - Reset currentPage to 1
    - Reapply current sort if active
    - Call renderTable()
    - Call updatePagination()
    - Call updatePageInfo()
    - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_
  - [x] 4.2 Attach search event listener
    - Input event on search field for real-time filtering
    - _Requirements: 2.1, 2.3_

- [x] 5. Implement sorting functionality
  - [x] 5.1 Implement handleSort() function
    - Check if clicking same field - toggle order (asc/desc)
    - If different field - set to ascending
    - Sort filteredProducts array by field
    - For title: use localeCompare()
    - For price: use numeric comparison
    - Update currentSortField and currentSortOrder
    - Call updateSortIcons()
    - Call renderTable()
    - _Requirements: 4.1, 4.2, 4.3, 4.5_
  - [x] 5.2 Implement updateSortIcons() function
    - Reset all sort icons to neutral state
    - Set active icon based on currentSortField and currentSortOrder
    - Use Font Awesome icons (fa-sort, fa-sort-up, fa-sort-down)
    - _Requirements: 4.4_
  - [x] 5.3 Attach sort event listeners
    - Click event on Title header
    - Click event on Price header
    - _Requirements: 4.1, 4.2_

- [x] 6. Checkpoint - Core features verification
  - Ensure all tests pass, ask the user if questions arise.
  - Verify: products load from API correctly
  - Verify: pagination works (5/10/20 items, prev/next, page numbers)
  - Verify: search filters in real-time (case-insensitive)
  - Verify: sorting works for Title and Price (toggle asc/desc)
  - Verify: no console errors

- [x] 7. Implement tooltip functionality
  - [x] 7.1 Implement showTooltip() function
    - Set tooltip content to product description
    - Position tooltip near cursor (pageX + offset, pageY + offset)
    - Make tooltip visible
    - _Requirements: 5.1, 5.2_
  - [x] 7.2 Implement hideTooltip() function
    - Hide tooltip element
    - _Requirements: 5.3_
  - [x] 7.3 Attach tooltip event listeners
    - Mouseover on table rows - show tooltip
    - Mousemove on table rows - update position
    - Mouseout on table rows - hide tooltip
    - _Requirements: 5.1, 5.2, 5.3_

- [x] 8. Implement Detail Modal
  - [x] 8.1 Implement openDetailModal() function
    - Find product by ID from allProducts
    - Populate modal with product data (title, price, category, description)
    - Generate image gallery HTML
    - Store currentProductId for edit functionality
    - Show modal using Bootstrap Modal API
    - _Requirements: 6.1, 6.2_
  - [x] 8.2 Attach detail modal event listeners
    - Click event on table rows (excluding buttons)
    - Edit button click to open edit modal
    - _Requirements: 6.1, 6.3_

- [x] 9. Implement Edit functionality
  - [x] 9.1 Implement openEditModal() function
    - Get current product data by currentProductId
    - Pre-fill form fields (title, price, description, categoryId, images)
    - Close detail modal
    - Open edit modal
    - _Requirements: 7.1_
  - [x] 9.2 Implement validateForm() function
    - Check title is not empty
    - Check price is valid number > 0
    - Check description is not empty
    - Check categoryId is valid
    - Return array of error messages
    - _Requirements: 7.6_
  - [x] 9.3 Implement handleUpdate() function
    - Get form values
    - Call validateForm() - show errors if invalid
    - Show loading state
    - Send PUT request to API_BASE_URL/products/{id}
    - Handle success: close modal, refresh products, show success message
    - Handle error: show error message
    - _Requirements: 7.3, 7.4, 7.5_
  - [x] 9.4 Attach edit modal event listeners
    - Save button click
    - Form submit event
    - _Requirements: 7.3_

- [x] 10. Implement Create functionality
  - [x] 10.1 Implement openCreateModal() function
    - Reset all form fields to empty
    - Open create modal
    - _Requirements: 8.1_
  - [x] 10.2 Implement handleCreate() function
    - Get form values
    - Call validateForm() - show errors if invalid
    - Show loading state
    - Send POST request to API_BASE_URL/products
    - Handle success: close modal, refresh products, show success message
    - Handle error: show error message
    - _Requirements: 8.3, 8.4, 8.5, 8.6_
  - [x] 10.3 Attach create modal event listeners
    - Create button click to open modal
    - Save button click in modal
    - Form submit event
    - _Requirements: 8.1, 8.3_

- [x] 11. Implement CSV Export
  - [x] 11.1 Implement escapeCSV() helper function
    - Escape double quotes by doubling them
    - Wrap fields containing commas, quotes, or newlines in double quotes
    - _Requirements: 9.3_
  - [x] 11.2 Implement exportToCSV() function
    - Get current page products (slice filteredProducts)
    - Create CSV header row
    - Create CSV data rows with escaped values
    - Generate filename: products_page_{N}_{timestamp}.csv
    - Create Blob with CSV content
    - Create download link and trigger click
    - _Requirements: 9.1, 9.2, 9.4_
  - [x] 11.3 Attach export event listener
    - Click event on Export CSV button
    - _Requirements: 9.1_

- [x] 12. Implement responsive design
  - [x] 12.1 Add responsive CSS media queries
    - Adjust padding/margins for small screens
    - Stack controls vertically on mobile
    - _Requirements: 10.1_
  - [x] 12.2 Ensure table is responsive
    - Wrap table in .table-responsive div
    - Allow horizontal scroll on small screens
    - _Requirements: 10.2_
  - [x] 12.3 Ensure modals are mobile-friendly
    - Use Bootstrap modal-dialog-scrollable
    - Adjust form layout for mobile
    - _Requirements: 10.3_

- [x] 13. Final checkpoint - All features complete
  - Ensure all tests pass, ask the user if questions arise.
  - Verify all CRUD operations work (Create, Read, Update)
  - Test search + pagination + sorting combined
  - Verify CSV export downloads correctly
  - Test on mobile viewport (320px+)
  - Cross-browser testing (Chrome, Firefox, Edge)
  - Verify no console errors
  - Clean up any debug console.log statements

## Notes

- Each task references specific requirements for traceability
- Checkpoints ensure incremental validation
- Use async/await for all API calls
- Use Bootstrap modals and components
- Test each feature immediately after implementation
